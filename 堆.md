# 堆
ref:
- [数据结构排序算法之堆排序演示](https://www.bilibili.com/video/av18980178/)

堆是一种满足以下条件的树：

堆中的每一个节点值都大于等于（或小于等于）子树中所有节点的值. 或者说，任意一个节点的值都大于等于（或小于等于）所有子节点的值.

堆分为 最大堆 和 最小堆。二者的区别在于节点的排序方式:
- 最大堆：堆中的每一个节点的值都大于等于子树中所有节点的值
- 最小堆：堆中的每一个节点的值都小于等于子树中所有节点的值

根据堆的性质可知，最大堆的堆顶元素为所有元素中最大的，最小堆的堆顶元素是所有元素中最小的。当需要多次查找最大元素或者最小元素的时候，可以利用堆来实现.

## 存储
由于完全二叉树的优秀性质，利用数组存储二叉树即节省空间，又方便索引

存储:
1. 若根结点的序号为 1，那么对于树中任意节点 i，其父节点i/2, 其左子节点序号为 `2*i`，右子节点序号为 `2*i+1`
1. 若根结点的序号为 0，那么对于树中任意节点 i，其父节点(i-1)/2, 其左子节点序号为 `2*i+1`，右子节点序号为 `2*i+2`

## 操作
以最大堆举例.

- 堆的操作总结插入元素：先将元素放至数组末尾，再自底向上堆化，将末尾元素上浮
- 删除堆顶元素：删除堆顶元素，将末尾元素放至堆顶，再自顶向下堆化，将堆顶元素下沉。也可以自底向上堆化，只是会产生“气泡”，浪费存储空间。**最好采用自顶向下堆化的方式**

### 插入
1. 将要插入的元素放到最后
1. 自底向上堆化: 从底向上，如果父结点比该元素小，则该节点和父结点交换，直到无法交换

### 删除
删除堆顶元素后，为了保持堆的性质，需要对堆的结构进行调整，将这个过程称之为"堆化"，堆化的方法分为两种：

1. 自底向上的堆化即元素从最底部向上移动

  1. 比较根结点的左子节点和右子节点, 将较大的元素填充到根结点
  1. 一直循环比较空出位置的左右子节点，并将较大者移至空位，直到堆的最底部

  缺点: 数组中出现了“气泡”，会导致存储空间的浪费

2. 自顶向下堆化，元素由最顶部向下移动

  1. 将最后一个元素移动到堆顶
  1. 然后不停与左右子节点的值进行比较，和较大的子节点交换位置，直到无法交换位置

## 堆排序
堆排序的过程分为两步：
1. 建堆，将一个无序的数组建立为一个堆

  建堆的过程就是一个对所有非叶节点的自顶向下堆化过程. 注意，顺序是从后往前堆化.

  最后一个节点的父结点及它之前的元素，都是非叶节点。也就是说，如果节点个数为 n，那么需要对 n/2 到 1 的节点进行自顶向下（沉底）堆化.
2. 排序，将堆顶元素取出，然后对剩下的元素进行堆化，反复迭代，直到所有元素被取出为止

  由于堆顶元素是所有元素中最大的，所以重复取出堆顶元素，将这个最大的堆顶元素放至数组末尾，并对剩下的元素进行堆化即可.

  采用自顶向下（沉底）堆化，这个堆化一开始要将末尾元素移动至堆顶，这个时候末尾的位置就空出来了，由于堆中元素已经减小，这个位置不会再被使用，所以可以将取出的元素放在末尾.

  这其实是做了一次交换操作，将堆顶和末尾元素调换位置，从而将取出堆顶元素和堆化的第一步(将末尾元素放至根结点位置)进行合并.
